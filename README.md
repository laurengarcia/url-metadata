# url-metadata
Request an http(s) url and scrape its metadata. Many of the metadata fields returned are [Open Graph Protocol (og:)](http://ogp.me/) so far.

Under the hood, this package does some post-request processing on top of the [request](https://www.npmjs.com/package/request) module.

If you want a new feature, please open an issue or pull request in [GitHub](https://github.com/LevelNewsOrg/url-metadata).


## Usage

To use in an npm/ Node.js project, install from your CLI:
```
$ npm install url-metadata --save`
```

Then in your project file (from example/basic.js):
```javascript
const urlMetadata = require('url-metadata')
urlMetadata('http://bit.ly/2ePIrDy').then(
  function (metadata) { // success handler
    console.log(metadata)
  },
  function (error) { // failure handler
    console.log(error)
  })
```

If you'd like to override the default options (see below), pass in a second argument:
```javascript
const urlMetadata = require('urlMetadata')
urlMetadata('http://bit.ly/2ePIrDy', {fromEmail: 'me@myexample.com'}).then(...)
```

### Options
This package's request defaults are the values below that you may want to override:
```javascript
{
  // custom name user agent that will make url request:
  userAgent: 'MetadataScraper',
  fromEmail: 'example@example.com',
  maxRedirects: 10,
  // timeout in milliseconds, default below is 10 seconds:
  timeout: 10000,
  // number of characters to truncate description to:
  descriptionLength: 750,
  // force image urls in selected tags to https,
  // valid for 'image', 'og:image' and 'og:image:secure_url' tags:
  ensureSecureImageRequest: true,
  // sourceMap example: https://github.com/LevelNewsOrg/source-map
  sourceMap: {},
  // custom function to encode the metadata fields before they are returned;
  // defaults to undefined:
  encode: undefined
}
```

#### Option: Encode
You can supply a custom function to encode the metadata fields before they are returned from this module, see `example/encode.js`:
```javascript
const options = {
  encode: function (value) {
    return encodeURIComponent(value).replace(/['*]/g, escape)
  }
}
```

### Returns
Returns a promise that gets resolved with the following url metadata if the url request response returns successfully. Note that the `url` field returned below will be the last hop in the request chain. So if you passed in a url that was generated by a link shortener, for example, you'll get back the final destination of the link as the `url`.
```javascript
{
  'url'                  : '',
  'canonical'            : '',
  'title'                : '',
  'image'                : '',
  'author'               : '',
  'description'          : '',
  'keywords'             : '',
  'source'               : '',
  'og:url'               : '',
  'og:locale'            : '',
  'og:locale:alternate'  : '',
  'og:title'             : '',
  'og:type'              : '',
  'og:description'       : '',
  'description'          : '',
  'og:determiner'        : '',
  'og:site_name'         : '',
  'og:image'             : '',
  'og:image:secure_url'  : '',
  'og:image:type'        : '',
  'og:image:width'       : '',
  'og:image:height'      : '',
  'price':               : '',
  'priceCurrency':       : '',
  'availability'         : ''
}
```

Additional fields are also returned if the url has an `og:type` set to `article`. These fields are:
```javascript
{
  'article:published_time'     : '',
  'article:modified_time'      : '',
  'article:expiration_time'    : '',
  'article:author'             : '',
  'article:section'            : '',
  'article:tag'                : '',
  'og:article:published_time'  : '',
  'og:article:modified_time'   : '',
  'og:article:expiration_time' : '',
  'og:article:author'          : '',
  'og:article:section'         : '',
  'og:article:tag'             : ''
}
```
